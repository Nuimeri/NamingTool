-----

## GASプロジェクトとVS Codeを同期！Claspの活用マニュアル

Google Apps Script（GAS）プロジェクトをローカルのVS Codeで開発する際、Googleのサーバー上のプロジェクトとローカルファイルを効率的に同期するために **Clasp** というコマンドラインツールが非常に便利です。このマニュアルでは、Claspのセットアップから基本的な同期操作までを解説します。

-----

### 1\. Claspとは？

Clasp（Command Line Apps Script Projects）は、Googleが提供するオープンソースのコマンドラインインターフェース（CLI）ツールです。これにより、GASプロジェクトをローカル環境（あなたのPC）のファイルとして管理し、VS Codeなどのエディタで編集した後、Google Apps Scriptプロジェクトにプッシュ（アップロード）したり、逆にGASプロジェクトをローカルにプル（ダウンロード）したりできます。

### 2\. 事前準備

Claspを使用するには、Node.jsとnpm（Node Package Manager）がPCにインストールされている必要があります。

1.  **Node.js と npm のインストール:**
    まだインストールしていない場合は、[Node.js の公式サイト](https://nodejs.org/) から推奨版（LTS版）をダウンロードしてインストールしてください。インストール後、コマンドプロンプトやターミナルで以下のコマンドを実行し、バージョンが表示されればOKです。

    ```bash
    node -v
    npm -v
    ```

2.  **Google Cloud Platform で Apps Script API を有効化:**
    ClaspがGASプロジェクトにアクセスできるように、Google Cloud Platform (GCP) で「Apps Script API」を有効にする必要があります。

      * [Google Cloud Platform の Apps Script API ページ](https://www.google.com/search?q=https://console.cloud.google.com/apis/library/appsactivity.googleapis.com) にアクセスします。（必要であればGoogleアカウントでログイン）
      * 「Apps Script API」を検索し、表示されたらクリックします。
      * **「有効にする」** ボタンをクリックします。

### 3\. Clasp のインストール

Node.jsとnpmが利用可能になったら、Claspをグローバルにインストールします。

1.  **コマンドプロンプトまたはターミナルを開く:**
    管理者権限は不要です。

2.  **Claspをインストールするコマンドを実行:**

    ```bash
    npm install -g @google/clasp
    ```

    `-g` オプションはグローバルインストールを意味し、どのディレクトリからでも `clasp` コマンドを使えるようになります。
    インストールが完了したら、バージョン確認コマンドを実行し、Claspが正しくインストールされたか確認します。

    ```bash
    clasp -v
    ```

### 4\. Clasp の認証（ログイン）

Claspを初めて使う際には、あなたのGoogleアカウントで認証する必要があります。

1.  **認証コマンドを実行:**
    ```bash
    clasp login
    ```
2.  **ブラウザでの認証:**
    コマンドを実行すると、デフォルトのウェブブラウザが開き、Googleアカウントのログイン画面が表示されます。
      * Claspがアクセスを要求する権限（Google Drive、Google Apps Scriptなど）を確認し、「許可」をクリックして認証を完了させます。
      * 認証が成功すると、ブラウザに「Logged in.」というメッセージが表示され、コマンドプロンプト/ターミナルにもログイン成功のメッセージが表示されます。

### 5\. GASプロジェクトの同期操作

これでClaspを使う準備が整いました。以下の主要なコマンドを使って、GASプロジェクトを同期します。

#### 5.1. 既存のGASプロジェクトをローカルにクローン（ダウンロード）する

すでにGoogleのサーバー上にGASプロジェクトが存在する場合、それをローカルにダウンロードしてVS Codeで編集できます。

1.  **GASプロジェクトのスクリプトIDを特定する:**

      * GASエディタでプロジェクトを開きます。
      * 左側のナビゲーションメニューから\*\*歯車のアイコン（プロジェクトの設定）\*\*をクリックします。
      * 「スクリプトID」という項目があるので、その値をコピーします。

2.  **クローンするディレクトリに移動:**
    VS Codeで開きたい、またはファイルを保存したいローカルのディレクトリにコマンドプロンプト/ターミナルで移動します。

    ```bash
    cd D:\your_project_folder\src # 例: あなたのプロジェクトの src ディレクトリ
    ```

3.  **クローンコマンドを実行:**

    ```bash
    clasp clone <YOUR_SCRIPT_ID>
    ```

    `<YOUR_SCRIPT_ID>` の部分には、先ほどコピーしたスクリプトIDを貼り付けてください。
    実行すると、GASプロジェクトのファイル（`.gs`, `.html`, `appsscript.json` など）が現在のディレクトリにダウンロードされます。同時に、`.clasp.json` という設定ファイルも生成されます。これは、このローカルディレクトリがどのGASプロジェクトと紐付いているかをClaspが認識するための重要なファイルです。

#### 5.2. ローカルの変更をGASプロジェクトにプッシュ（アップロード）する

VS Codeでファイルを編集した後、その変更をGoogleのサーバー上のGASプロジェクトに反映させます。

1.  **作業ディレクトリに移動:**
    クローンしたプロジェクトのルートディレクトリ（`.clasp.json` がある場所）にコマンドプロンプト/ターミナルで移動します。

    ```bash
    cd D:\your_project_folder\src # .clasp.json が src ディレクトリ直下にある場合
    ```

2.  **プッシュコマンドを実行:**

    ```bash
    clasp push
    ```

    実行すると、ローカルファイルの変更がGASプロジェクトにアップロードされます。GASエディタを開くと、変更が反映されていることを確認できます。

#### 5.3. GASプロジェクトの変更をローカルにプル（ダウンロード）する

GASエディタで直接変更を加えた場合など、Googleのサーバー上のプロジェクトがローカルよりも新しい場合に、その変更をローカルにダウンロードします。

1.  **作業ディレクトリに移動:**
    プッシュ操作と同様に、`.clasp.json` があるディレクトリに移動します。

2.  **プルコマンドを実行:**

    ```bash
    clasp pull
    ```

    実行すると、Google Apps Scriptプロジェクトの最新の状態がローカルファイルにダウンロードされ、ローカルのファイルが更新されます。

#### 5.4. 新しいGASプロジェクトを作成し、ローカルと紐付ける（オプション）

まだGASプロジェクトがない状態でローカルで開発を始めたい場合は、Claspを使って新しいGASプロジェクトを作成し、紐付けることもできます。

1.  **新しいプロジェクトを作成したいディレクトリに移動:**

    ```bash
    cd D:\new_gas_project
    ```

2.  **新規作成コマンドを実行:**

    ```bash
    clasp create --type standalone --title "My New GAS Project"
    ```

      * `--type standalone`: スタンドアロンなGASプロジェクトを作成します。（Googleドキュメントなどに紐付かない）
      * `--title "My New GAS Project"`: プロジェクトのタイトルを指定します。
        実行すると、新しいGASプロジェクトがGoogleのサーバー上に作成され、そのIDが`.clasp.json` に記録されてローカルと紐付けられます。同時に、デフォルトの `Code.gs` と `appsscript.json` がローカルにダウンロードされます。

### 6\. トラブルシューティング（一般的な問題）

  * **「Not logged in.」エラー:** `clasp login` コマンドで再認証してください。
  * **「Script ID not found.」エラー:** `.clasp.json` ファイルが正しくないか、コマンドを実行しているディレクトリにない可能性があります。適切なディレクトリに移動するか、`clasp clone` で正しいスクリプトIDを指定して再試行してください。
  * **「Apps Script API is not enabled.」エラー:** 事前準備の「Google Cloud Platform で Apps Script API を有効化」の手順を確認してください。

Claspを使いこなすことで、GASプロジェクトの開発が格段に効率的になります。VS Codeの強力な編集機能とClaspの同期機能を組み合わせて、快適な開発環境を構築しましょう。